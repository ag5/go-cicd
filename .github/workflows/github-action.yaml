# This action is copied from https://github.com/ag5/go-cicd
# DO NOT EDIT
# Version 1.1.0

name: Build Docker image on AWS Codebuild
on:
  push:
    tags:
      - '*'
jobs:
  trigger-codebuild:
    runs-on: ubuntu-latest
    env: 
      AWS_ACCESS_KEY_ID: ${{secrets.AWS_ACCESS_KEY_ID}}
      AWS_SECRET_ACCESS_KEY: ${{secrets.AWS_SECRET_ACCESS_KEY}}
      AWS_DEFAULT_REGION: "eu-central-1"
    steps:
      - uses: actions/checkout@master
        with:
          repository: ag5/go-cicd
      - name: version
        id: install-aws-cli
        uses: unfor19/install-aws-cli-action@master
        with:
          version: "2.0.30"
      - run: aws codebuild start-build --project-name go-release-builder --secondary-sources-override type=GITHUB,location=https://github.com/${GITHUB_REPOSITORY},gitCloneDepth=5,gitSubmodulesConfig={fetchSubmodules=false},buildspec=./buildspec.yaml,reportBuildStatus=false,sourceIdentifier=sourceidentifier --environment-variables-override name=GIT_TAG,value=${GITHUB_REF##*/},type=PLAINTEXT name=IMAGE_REPO_NAME,value=${{ github.event.repository.name }},type=PLAINTEXT name=GITHUB_REPOSITORY,value=${GITHUB_REPOSITORY},type=PLAINTEXT
        shell: bash

# DO NOT EDIT
